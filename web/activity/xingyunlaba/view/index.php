<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>幸运拉霸，财运拉回家</title>
<script type="text/javascript" src="web/activity/xingyunlaba/js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="web/activity/xingyunlaba/js/jquery.easing.1.3.js"></script>
<style type="text/css">
body {
	               margin: 0 auto;
	               padding: 0;
	               text-align: center;
}
a {
	               text-decoration: none;
                   -webkit-tap-highlight-color: rgba(0,0,0,0);
}
td  {
	               border: solid 1px;
	               padding: 10px;
}


.float_left {
	               float: left;
}
.float_right {
	               float: right;
}
.clear {
	               clear: both;
}
.relative {
	               position: relative;
}
.absolute {
	               position: absolute;
}
.tab {
	               width: 189px; 
	               height: 66px;
	               margin-top:8px;
	               line-height: 66px;
	               display: inline-block;
                   color: #ecac64;
                   font-size: 32px;
}
.shin  {
	               background: url(web/activity/xingyunlaba/image/laba12_n.png?v=1);
	               width: 24px;
	               height: 24px;
	
}
.shine  {
	               background: url(web/activity/xingyunlaba/image/laba13_n.png?v=1);
	               width: 35px;
	               height: 35px;
	
}
.num {
                    background: url(web/activity/xingyunlaba/image/laba6_n.png) top center repeat-y;
                    width: 171.5px;
                    height: 254px;
                    float: left;
}

</style>
</head>
<body>
    <div id="main" class="relative" style="width: 1280px;height: 800px; margin: 0 auto; background: url(web/activity/xingyunlaba/image/bg.jpg);">
        <div id="header" style="height: 74px;background: url(web/activity/image/head_ddz.png)">
            <a id="tab_2" class="tab float_right" href="javaScript:;" style="background: url(web/activity/image/caidan_leave.png);margin-right: 190px;">活动介绍</a>
            <a id="tab_1" class="tab float_right" href="javaScript:;" style="background: url(web/activity/image/caidan_on.png);margin-right: 15px;">活动</a>
        </div>
        <div id="content" class="relative" style=" width: 1280px; height: 726px;">
            <div id="table_1" >
                <div class="relative" style="background: url(web/activity/xingyunlaba/image/laba2_n.png?v=1); width: 957px; height: 695px; left: 202px;">
                    <!-- 闪灯 -->
                    <div>
                        <div id="shin1" class="shin absolute" style="left: 190px; top: 76px; display: none;"></div>
                        <div id="shin2" class="shin absolute" style="left: 220px; top: 49px; display: none;"></div>
                        <div id="shin3" class="shin absolute" style="left: 256px; top: 29px; display: none;"></div>
                        <div id="shin4" class="shin absolute" style="left: 293px; top: 13px; display: none;"></div>
                        <div id="shin5" class="shin absolute" style="left: 333px; top: 4px; display: none;"></div>
                        <div id="shin6" class="shin absolute" style="left: 374px; top: -3px; display: none;"></div>
                        <div id="shin7" class="shin absolute" style="left: 416px; top: -5px; display: none;"></div>
                        <div id="shin8" class="shin absolute" style="left: 455px; top: -3px; display: none;"></div>
                        <div id="shin9" class="shin absolute" style="left: 496px; top: 4px; display: none;"></div>
                        <div id="shin10" class="shin absolute" style="left: 536px; top: 15px; display: none;"></div>
                        <div id="shin11" class="shin absolute" style="left: 573px; top: 30px; display: none;"></div>
                        <div id="shin12" class="shin absolute" style="left: 610px; top: 50px; display: none;"></div>
                        <div id="shin13" class="shin absolute" style="left: 639px; top: 76px; display: none;"></div>
                    </div>
                    <div>
                        <div id="shine1" class="shine absolute" style="left: 19px; top: 120px; display: none;"></div>
                        <div id="shine2" class="shine absolute" style="left: 129px; top: 120px; display: none;"></div>
                        <div id="shine3" class="shine absolute" style="left: 239px; top: 120px; display: none;"></div>
                        <div id="shine4" class="shine absolute" style="left: 349px; top: 120px; display: none;"></div>
                        <div id="shine5" class="shine absolute" style="left: 459px; top: 120px; display: none;"></div>
                        <div id="shine6" class="shine absolute" style="left: 569px; top: 120px; display: none;"></div>
                        <div id="shine7" class="shine absolute" style="left: 679px; top: 120px; display: none;"></div>
                        <div id="shine8" class="shine absolute" style="left: 798px; top: 120px; display: none;"></div>
                        <div id="shine9" class="shine absolute" style="left: 799px; top: 214px; display: none;"></div>
                        <div id="shine10" class="shine absolute" style="left: 799px; top: 305px; display: none;"></div>
                        <div id="shine11" class="shine absolute" style="left: 798px; top: 409px; display: none;"></div>
                        <div id="shine12" class="shine absolute" style="left: 679px; top: 409px; display: none;"></div>
                        <div id="shine13" class="shine absolute" style="left: 569px; top: 409px; display: none;"></div>
                        <div id="shine14" class="shine absolute" style="left: 459px; top: 409px; display: none;"></div>
                        <div id="shine15" class="shine absolute" style="left: 349px; top: 409px; display: none;"></div>
                        <div id="shine16" class="shine absolute" style="left: 239px; top: 409px; display: none;"></div>
                        <div id="shine17" class="shine absolute" style="left: 129px; top: 409px; display: none;"></div>
                        <div id="shine18" class="shine absolute" style="left: 19px; top: 409px; display: none;"></div>
                        <div id="shine19" class="shine absolute" style="left: 19px; top: 305px; display: none;"></div>
                        <div id="shine20" class="shine absolute" style="left: 19px; top: 214px; display: none;"></div>
                    </div>
                    <!--  -->
                    <div class="absolute" style="width: 704px; height: 254px; left: 75px; top: 155px;">
                        <div>
                            <div style="background: url(web/activity/xingyunlaba/image/laba3_n.png); width: 704px; height: 254px;"></div>
                            <div class=" absolute" style="top: 0;">
                                <div class="num" style="margin-right: 6px;"></div>
                                <div class="num" style="margin-right: 6px;"></div>
                                <div class="num" style="margin-right: 6px;"></div>
                                <div class="num"></div>
                            </div>
                        </div>
                    </div>
                    <!-- 下注金额提示框 -->
                    <div class="absolute" style="height: 54px; left: 58px; top: 478px; line-height: 54px;">
                        <span style="height: 54px; line-height: 54px;"><img src="web/activity/xingyunlaba/image/laba7_n.png"></span>
                        <span id="xiazhu" style="height: 54px; line-height: 56px; vertical-align: text-bottom;">
                            <img src="web/activity/xingyunlaba/image/laba9-0.png" style="vertical-align: middle;">
                        </span>
                    </div>
                    <!-- 中奖金额提示框 -->
                    <div class="absolute" style="height: 54px; left: 488px; top: 478px;">
                        <span style="height: 54px; line-height: 54px;"><img src="web/activity/xingyunlaba/image/laba8_n.png"></span>
                        <span id="zhongjiang" style="height: 54px; line-height: 56px; vertical-align: text-bottom;">
                            <img src="web/activity/xingyunlaba/image/laba9-0.png" style="vertical-align: middle;">
                        </span>
                    </div>
                    <div class="absolute" style="width: 711px; height: 110px; left: 40px; top: 555px; letter-spacing: -4px; word-spacing: -4px; font-size: 0;">
                        <span id="moneyButton1" class="button" style="background: url(web/activity/xingyunlaba/image/laba4_n.png?v=1); width: 174px; height: 110px; margin-right:5px; line-height:110px; display: inline-block"></span>
                        <span id="moneyButton2" class="button" style="background: url(web/activity/xingyunlaba/image/laba4_n.png?v=1); width: 174px; height: 110px; margin-right:5px; line-height:110px; display: inline-block"></span>
                        <span id="moneyButton3" class="button" style="background: url(web/activity/xingyunlaba/image/laba4_n.png?v=1); width: 174px; height: 110px; margin-right:5px; line-height:110px; display: inline-block"></span>
                        <span id="moneyButton4" class="button" style="background: url(web/activity/xingyunlaba/image/laba4_n.png?v=1); width: 174px; height: 110px; line-height:110px; display: inline-block"></span>
                    </div>
                    <!-- 开始按钮 -->
                    <div id="go" class="absolute" style="background: url(web/activity/xingyunlaba/image/laba5_n.png); width: 173px; height: 173px; left: 759px; top: 488px;">
                    </div>
                </div>
            </div>
            <!-- 活动说明 -->
            <div id="table_2" style="display: none;">
                <div style="color: #fff; width: 1000px; text-align: left; margin: 100px auto; font-size: 36px;">
                    <div style="padding: 10px;">活动内容:</div>
                    <div style="padding: 10px;">1.选择押注金额后点击GO按钮开始转动水果机</div>
                    <div style="padding: 10px;">2.两个或三个相同则获得多倍奖励</div>
                    <table style="background: #AB1F5E; margin: 30px auto; border-spacing: 0; text-align: center">
                        <tr>
                            <td>相同数量/倍数</td>
                            <td>苹果</td>
                            <td>橙子</td>
                            <td>草莓</td>
                            <td>猕猴桃</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2</td>
                            <td>2</td>
                            <td>2</td>
                            <td>2</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>4</td>
                            <td>4</td>
                            <td>4</td>
                            <td>4</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>20</td>
                            <td>20</td>
                            <td>20</td>
                            <td>20</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div id="caution" class="absolute" style="left:50%;top:45%; z-index: 10; margin: -104px 0 0 -294px; display: none;">
        	<div class="relative">
		        <div style="background-color:#000; border: solid 4px #FFD700; border-radius:30px; width:550px; height:200px; opacity:0.8;"></div>
		        <span id="cmessage" class="absolute" style="color:#FFF; line-height:105px; font-size: 30px; z-index:100; left:0; top:0; width:550px; height:200px; line-height:200px; margin: 4px;"></span>
	       	</div>
       	</div>
    </div>
</body>
<script type="text/javascript">
$(this).ready(function(){

	var i = 1;
	var x = 0;
	var j = 1;
	//开奖框背景切换
    function fun(){
    	if (x==0){
			i++;
			$("#shin"+(i-1)).hide();
	    	$("#shin"+i).show();
			if (i==13){
			    x = 1;
			}
		}else if (x==1){
			i--;
			$("#shin"+(i+1)).hide();
			$("#shin"+i).show();
			if (i==1){
			    x = 0;
			}
		}
    }
	
	function funa(){
		if (j==1){
			$("#shine"+j).show();
			$("#shine20").hide();
		}else {
			$("#shine"+j).show();
			$("#shine"+(j-1)).hide();
			if (j==20){
			    j = 0;
			}
		}
		
		j++;
	}
	//循环执行，每隔0.4秒钟执行一次
	window.setInterval(fun, 100);
	window.setInterval(funa, 100);

	
	//头部卡片切换
	$(".tab").click(function(){
		var now_tab = $(this).attr("id").replace("tab_","");
		$("#table_1").hide();
		$("#table_2").hide();
		$("#tab_1").css("background-image","url(web/activity/image/caidan_leave.png)");
		$("#tab_2").css("background-image","url(web/activity/image/caidan_leave.png)");
		if(now_tab==1){
			$("#tab_1").css("background-image","url(web/activity/image/caidan_on.png)");
			$("#table_1").show();
		}else {
			$("#tab_2").css("background-image","url(web/activity/image/caidan_on.png)");
			$("#table_2").show();
		}
	});

	//用图片替代数字
	function to_img (number,str,num){
		var number= number;
		var len   = number+'';
		
		var imgs=['0.png','1.png','2.png','3.png','4.png','5.png','6.png','7.png','8.png','9.png'];
		var ns='0123456789'.split('');
		var output='';
		if (len.length<5){
			var number=number+'';
			for(var i=0;i<number.length;i++){
				for(var j=0;j<ns.length;j++){
					if(number[i]==ns[j]){
					output+="<img src=web/activity/xingyunlaba/image/"+str+imgs[j]+" style='vertical-align: middle;'/>";
					break;
			   		}
			  	}
			}
		}else {
			var number=(number/10000)+'';
			for(var i=0;i<number.length;i++){
				for(var j=0;j<ns.length;j++){
					if(number[i]==ns[j]){
					output+="<img src=web/activity/xingyunlaba/image/"+str+imgs[j]+" style='vertical-align: middle;' />";
					break;
			   		}
			  	}
			}
			output+="<img src=web/activity/xingyunlaba/image/"+str+num+".png style='vertical-align: middle;' />";
		}
		
		return output;
	}


	//按钮金额图片
    var money1  = <?php echo $buttonMoney1?>;
    var money2  = <?php echo $buttonMoney2?>;
    var money3  = <?php echo $buttonMoney3?>;
    var money4  = <?php echo $buttonMoney4?>;
	
    var buttonMoney1 = to_img(money1,'laba11-','10');
    var buttonMoney2 = to_img(money2,'laba11-','10');
    var buttonMoney3 = to_img(money3,'laba11-','10');
    var buttonMoney4 = to_img(money4,'laba11-','10');
    
    $("#moneyButton1").html(buttonMoney1);
	$("#moneyButton2").html(buttonMoney2);
	$("#moneyButton3").html(buttonMoney3);
	$("#moneyButton4").html(buttonMoney4);

	//下注金额图片显示
	var money;
	var on = 0;
    var userMoney = <?php echo $userGameInfo['money'] ? $userGameInfo['money'] : 0?>;

	if (userMoney<money2){
		money = money1;
    	$("#xiazhu").html(to_img(money,'laba9-','10'));
    	$("#moneyButton1").css("background-image","url(web/activity/xingyunlaba/image/laba4_f.png?v=1)");
	}else {
		money = money2;
    	$("#xiazhu").html(to_img(money,'laba9-','10'));
    	$("#moneyButton2").css("background-image","url(web/activity/xingyunlaba/image/laba4_f.png?v=1)");
	}
	
    $(".button").click(function(){
        $(".button").css("background-image","url(web/activity/xingyunlaba/image/laba4_n.png?v=1)")
        $(this).css("background-image","url(web/activity/xingyunlaba/image/laba4_f.png?v=1)");
        var id  = $(this).attr('id').replace("moneyButton","");
        switch (id) {
            case '1':
                money = money1;
                break;
            case '2':
                money = money2;
                break;
            case '3':
                money = money3;
                break;
            case '4':
                money = money4;
                break;
        }

        $("#xiazhu").html(to_img(money,'laba9-','10'));
    });

    //开始按钮按下效果
    $("#go").mousedown(function(){
        $(this).css("background-image","url(web/activity/xingyunlaba/image/laba5_f.png)");
    });

    $("#go").mouseup(function(){
        $(this).css("background-image","url(web/activity/xingyunlaba/image/laba5_n.png)");
    });


    //开始抽奖
    var dateTime=new Date();
    var ss=dateTime.getSeconds();
    
    function go () {
        $(this).css("background-image","url(web/activity/xingyunlaba/image/laba5_n.png)");
        if(money){
            $.ajax({
            	type:"POST",
    			url:"<?php echo $url ?>?m=activity&p=dispath&fpath=xingyunlaba&mtkey=<?php echo $mtkey?>&act=set&v="+ss,
    			dataType: "json", 	
    			data:"&gameid=<?php echo $gameid?>"
    				+"&mid=<?php echo $mid?>"
    				+"&sid=<?php echo $sid?>"
    				+"&cid=<?php echo $cid?>"
    				+"&pid=<?php echo $pid?>"
    				+"&ctype=<?php echo $ctype?>"
    				+"&money="+money,
    				
    			success:function(e){
    				$("#go").unbind('mouseup').css("cursor","default"); //禁止转动过程中按钮点击
    				var result;
    			    var num_arr;
    				var u = 254;

    				status  = e.status;
    				famoney = e.famoney;
    				result  = e.number;

    			    var mlen = money+'';
    			    var flen = famoney+'';

    				if (status==1){
        				$(".num").css('backgroundPositionY',0);
        				num_arr = (result+'').split('');
        				
        				$(".num").each(function(index){
        					var _num = $(this);
        					setTimeout(function(){
        						_num.animate({ 
        							backgroundPositionY: (u*41) - (u*num_arr[index])
        						},{
        							duration: 6000+index*500,
        							easing: "easeInOutCirc",
        							complete: function(){
        								if (index==3){
        									$("#zhongjiang").html(to_img(famoney,'laba9-','10'));
            								if (famoney>0){
            									$("#cmessage").html("本次投注<span style='color:#FFFF00'> "+money+" </span>获得<span style='color:#FFFF00'> "+famoney+" </span>金币！");
            									//$("#cmessage").text("本次投注 "+money+" 获得 "+famoney+" 金币！");
            								}else {
            									$("#cmessage").text("很遗憾，本次未获奖，再接再厉哦！");
                							}
        				                	$("#caution").stop(true,true).fadeIn(1000);
        				    				
        				    				setTimeout(function(){
        				    					$("#caution").stop(true,true).fadeOut(2000);
    				    			        },3000);
        									goOn ();//转动停止后绑定监听器
        								};
        							}
        						});
        					}, index * 300);
        				});
    				}else if (status==-1){
    					$("#cmessage").text("您的金币不足！请前往商城进行充值");
                    	$("#caution").stop(true,true).fadeIn(2000);
                    	
                    	setTimeout(function(){
	    					<?php if (!in_array($cid, Config_Switch::$activity_switch_cid)):?>
	    					  window.location.href="http://www.dianlergame.com/paycenter/index.php?m=pay&p=index&act=list&gameid=<?php echo $gameid?>&mid=<?php echo $mid?>&sid=<?php echo $sid?>&cid=<?php echo $cid?>&pid=<?php echo $pid?>&ctype=<?php echo $ctype?>&versions=&mnick=<?php echo $mnick?>&money=<?php echo $money?>"; 
	    					<?php endif;?>
	    					$("#caution").stop(true,true).fadeOut(2000);
    			        },3000);
        			}else {
    					$("#cmessage").text("出错了！("+status+")");
                    	$("#caution").stop(true,true).fadeIn(2000);
                    	
                    	setTimeout(function(){
	    					$("#caution").stop(true,true).fadeOut(2000);
    			        },3000);
        			}
    			}
            });
        }else {
        	$("#cmessage").text("请选择下注金额");
        	$("#caution").stop(true,true).fadeIn(2000);
        	
        	setTimeout(function(){
				$("#caution").stop(true,true).fadeOut(2000);
	        },3000);
        }
    };

    function goOn () {
        $("#go").mouseup(function(){
        	$("#zhongjiang").html(to_img(0,'laba9-','10'));
            go();
        });
    }

    goOn ();
});
</script>
</html>